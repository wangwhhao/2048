# 2048
小游戏仿写
## 制作一个简单的游戏需要的技术
 1. 游戏逻辑
 2. 技术：html/css/js/jquery
 3. 创意：关键

## 游戏架构
 * 视图层：UI--html/css
   
   > 网页布局
 * 控制层：主逻辑--js/jquery
 
   > 初始化棋盘格,双重循环遍历每个小格子进行逻辑操作
   
   > 在随机两个格子生成数字
 * 模型层--游戏数据
 
   > 数据包括分数和棋盘格 
 * 动画效果逻辑
 * 支撑逻辑
 
## 游戏逻辑
 * 在4*4格子中我们移动的是数字，所以要在board上建立一个二维数组来存number。当数字不为0时以不同的颜色在相应的位置显示出来。
 * 判断格子里是否有空间，有的话在随机位置生成数字，并在随机的位置显示随机数字。还有判断随机位置是否有数字
 * 编写生成随机数的动画

## 游戏交互
 * 了解游戏循环
 
   > 基于时间：游戏初始化--判断游戏是否结束--根据时间的流逝更新游戏数据
   
   > 基于玩家响应：与上一个类似，只不过根据玩家的响应更新游戏数据（2048属于这一类）
 * 判断玩家是否按了上下左右四个按键
  
   > 判断是否可以移动
   
   > 生成随机数字
   
   > 判断游戏是否结束
 * 交互细节
 
   > 比如判断是否能向左移动，就要知道左侧第一列不能移动，右侧三列只有在当前列可移动情况有两种：1.左侧有空间时；2.左侧列的数字与当前列的数字相同可叠加。当然能否移动的前提是当前格子有数字。
 
   > 真正向左移动，要每个数字左侧位置进行判断，看是否可能为落脚点:1.落脚点是否为空;2.落脚点数字与待判定数字是否相等;3.落脚点与当前位置中间是否有障碍物
 * 交互逻辑调试
 
   > 编写没有障碍物的函数
   
   > 编写移动动画函数
   
   > 动画没来得及播放，updateBoardView就重置了，所以用setTimeout来让他慢一点更新界面，
   
   > 判断游戏结束：没有空间且不能移动
   
## 优化
 * 加入score
 
   > 发生在移动且数字叠加
   
 * 让每次移动时一个方格里只能产生一次叠加
 
   > 声明一个数组hasConflicted，像board一样做成二维数组对应每个小格子，并初始化和updateBoardView时设置false--初始情况下每个位置都没有进行过碰撞。
   
   > 实际游戏过程中应用这个值，在移动时，除了判断两个值相等且移动路径没有障碍物之外，还要判断将要落脚点的位置没有发生过碰撞。碰撞如果发生了还要把hasConflicted值设置为true，这样下一次在落脚点位置就不能发生碰撞了。
   
 * 优化随机位置
   ```
    var tempObj = [];
    for(var i=0;i<4;i++){
        for(var j=0;j<4;j++){
            if(board[i][j] == 0){
                tempObj.push(i+","+j);
            }
        }
    }
    var randNum = parseInt(Math.floor(Math.random()*tempObj.length)),
    randx = parseInt(tempObj[randNum].split(",")[0]),
    randy = parseInt(tempObj[randNum].split(",")[1]);
    ```
    
 * 阻止默认行为，当屏幕尺寸小，出现滚动条时，按上下键会出现数字和滚动条同时上下跳动，可以用event.preventDefault阻止默认行为
    
## 支持移动端
 * 触控方式
 
   > 获取触控位置及坐标信息:touchstart和touchend事件，信息在event里
   
   > 手指滑动的距离小于一定的值（比如屏幕宽度的0.3），不做任何回应。这样避免了手指点击触发数字滑动
 * viewport元信息
   ```
   <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,
    minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
   ```
   
 * 宽高等绝对的值改为相对的值，百分比形式
 
